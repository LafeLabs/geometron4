<html>
<head>
    <!--Stop Google:-->
    <META NAME="robots" CONTENT="noindex,nofollow">
    <script src="javascript/mapfactory.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.js"></script>
    <script>
    
var mapdata = {
    "name": "mynewmap",
    "array": [
        {
            "x": 0.2,
            "y": 0.2,
            "w": 0.5,
            "h": 1,
            "angle": 0,
            "text": "",
            "href": "",
            "url": "http://geometron.000webhostapp.com/uploadimages/image27.jpg",
            "type": "image"
        },
        {
            "x": 0.5,
            "y": 0.25,
            "w": 0.15,
            "h": 1,
            "angle": 0,
            "text": "TOP",
            "href": "",
            "url": "",
            "type": "text"
        },
        {
            "x": 0.5,
            "y": 0.5,
            "w": 0.15,
            "h": 1,
            "angle": 0,
            "text": "<span style =\"color:red\">BOTTOM</span>",
            "href": "",
            "url": "",
            "type": "text"
        },
        {
            "x": 0.4,
            "y": 0.4,
            "w": 0.1,
            "h": 1,
            "angle": 180,
            "text": "",
            "href": "index.html",
            "url": "http://www.cherrytreemaryland.xyz/symbol/svg/svg1556330629.svg",
            "type": "image"
        }
    ]
}
</script>
</head>
<body>    

    <div id = "mainmap"></div>
    <div id = "hammerxy">
        <!--this covers the map exactly, sits at higher z index, and is turned off when NOT editing xy-->
    </div>
    <div id = "margin">
        <div id = "arrayeditbar">
            <!--
                top of array edit bar is "name: [input] "
                each row has "edit", "up", "down","delete", the actual element, forced into the size with overflow hidden
                when edit is clicked the linkeditbar opens and this closes
            -->    
            <table id = "arraynametable">
                <tr><td>Name:</td></tr>
                <tr><td><input id = "arraynameinput"/></td></tr>
            </table>
        </div>            
        <div id = "linkeditbar">
        <!--
        link edit bar only opens when a LINK in a map array is being edited, based on clicking the "edit" button in a row in arrayeditbar
        to close, press the close button
        -->
            <div id = "savebutton" class = "button">SAVE</div>
            <div id = "closebutton" class = "button">CLOSE</div>
            <div id = "newbutton" class = "button">NEW</div>
            <div id = "nextbutton" class = "button">NEXT</div>
            <div id = "prevbutton" class = "button">PREV</div>
            <div id = "deletebutton" class = "button">DELETE</div>

            <table id = "linkedittable">
            <!--
            table with: text, url, href, pulldown menu for type, x,y,angle,w,h,
            -->
                <tr><td>text:</td><td><input id = "textinput"/></td></tr>
                <tr><td>url:</td><td><input id = "urlinput"/></td></tr>
                <tr><td>href:</td><td><input id = "hrefinput"/></td></tr>

            </table>       
            <table id = "sliderbarcontroltable">
            <!--
            select what is being controlled: angle, w, h, 
            -->
            </table>
            <div id = "sliderbar">
            <!--Vertical slider bar on far right side of screen, only turns on in edit mode-->
            </div>
            <div id = "sliderbar2">
                    <!--Vertical slider bar on far right side of screen, only turns on in edit mode-->
            </div>
        </div>
            
    </div>
     


<script>

landscape = false;

if(innerWidth > innerHeight){
    mapWidth = innerHeight;
    document.getElementById("margin").style.width = (innerWidth - mapWidth).toString() + "px";
    document.getElementById("margin").style.height = (innerHeight).toString() + "px";
    marginWidth = innerWidth - mapWidth;
    landscape = true;
}
else{
    mapWidth = innerWidth;
    document.getElementById("margin").style.height = (innerHeight - mapWidth).toString() + "px";
    document.getElementById("margin").style.width = (innerHeight).toString() + "px";
    marginWidth = mapWidth - innerWidth;
}

document.getElementById("hammerxy").style.width = (mapWidth).toString() + "px";
document.getElementById("hammerxy").style.height = (mapWidth).toString() + "px";

mainmap = new Map("main map");
mainmapbox = new MapBox(mapWidth,mapWidth,mainmap,document.getElementById("mainmap"));

mainmap.array = mapdata.array;
mainmapbox.draw(mainmapbox);

document.getElementById("arraynameinput").value = mainmap.name;

linkindex = 0;

for(var index = 0;index < mainmap.array.length; index++) {
    var newdiv = document.createElement("DIV");
    document.getElementById("arrayeditbar").appendChild(newdiv);
    if(mainmap.array[index].type == "image") {
        var newimg = document.createElement("IMG");
        newimg.src = mainmap.array[index].url;
        newdiv.appendChild(newimg);
        newimg.width = marginWidth*0.5;
        newimg.style.display = "block";
        newimg.style.margin = "auto";
    }
    if(mainmap.array[index].type == "text") {
        newdiv.innerHTML = mainmap.array[index].text;
    }
    newdiv.classList.add("arraylink");
    newdiv.classList.add("button");
    newdiv.style.border = "solid";
    newdiv.id = "link" + index.toString();
    newdiv.onclick = function(){
        document.getElementById("arrayeditbar").style.display = "none";
        document.getElementById("linkeditbar").style.display = "block";
        linkindex = parseInt(this.id.substring(4));
        document.getElementById("textinput").value = mainmap.array[linkindex].text;   
        document.getElementById("urlinput").value = mainmap.array[linkindex].url;   
        document.getElementById("hrefinput").value = mainmap.array[linkindex].href;   
        document.getElementById("hammerxy").style.zIndex = 100;
    }
}

document.getElementById("closebutton").onclick = function() {
    document.getElementById("arrayeditbar").style.display = "block";
    document.getElementById("linkeditbar").style.display = "none";
    document.getElementById("hammerxy").style.zIndex = -100;
}

document.getElementById("textinput").onchange = function() {
    mainmap.array[linkindex].text = this.value;
    mainmapbox.draw(mainmapbox);

    //also need to update the array editor
}
document.getElementById("urlinput").onchange = function() {
    mainmap.array[linkindex].url = this.value;
    mainmapbox.draw(mainmapbox);
    //also need to update the array editor
}

mc = new Hammer(document.getElementById("hammerxy"));
mc.get('pan').set({ direction: Hammer.DIRECTION_ALL });
mc.on("panleft panright panup pandown tap press rotate", function(ev) {
    mainmapbox.linkArray[linkindex].style.left = (ev.deltaX + mainmapbox.map.array[linkindex].x*mainmapbox.w).toString() +  "px";
    mainmapbox.linkArray[linkindex].style.top = (ev.deltaY + mainmapbox.map.array[linkindex].y*mainmapbox.w).toString() +  "px";
});    

mczoom = new Hammer(document.getElementById("sliderbar"));
mczoom.get('pan').set({ direction: Hammer.DIRECTION_ALL });
mczoom.on("panleft panright panup pandown tap press rotate", function(ev) {
    if(landscape){
        mainmapbox.linkArray[linkindex].style.width = (Math.abs(mainmapbox.map.array[linkindex].w*mainmapbox.w - 2*ev.deltaY)).toString() +  "px";
    }
    else{
        mainmapbox.linkArray[linkindex].style.width = (Math.abs(mainmapbox.map.array[linkindex].w*mainmapbox.w - 2*ev.deltaX)).toString() +  "px";
    }

});    

mcrotate = new Hammer(document.getElementById("sliderbar2"));
mcrotate.get('pan').set({ direction: Hammer.DIRECTION_ALL });
mcrotate.on("panleft panright panup pandown tap press rotate", function(ev) {

    mainmapbox.linkArray[linkindex].style.transform = "rotate(" + (mainmapbox.map.array[linkindex].angle + ev.deltaY*Math.PI/10).toString() + "deg)";

});    

</script>
<style>
body{
    overflow:hidden;
}
input,table{
    font-family:courier;
}

#mainmap{
    position:absolute;
    left:0px;
    top:0px;
    overflow:hidden;
}
#hammerxy{
    position:absolute;
    left:0px;
    top:0px;
    z-index:-100;
    overflow:hidden;
}
#margin{
    position:absolute;
    right:0px;
    bottom:0px;
    border:solid;
    border-color:red;
    border-width:0.2px;
}
#arrayeditbar{
    position:absolute;
    right:0px;
    bottom:0px;
    top:0px;
    left:0px;
    overflow:scroll;
    font-family:courier;
}
.arraylink{
    border:solid;
    border-width:0.1px;
    border-radius:10px;
    margin-top:15px;
}
.button{
    cursor:pointer;
    margin-bottom:1em;
}
.button:hover{
    background-color:#50ff50;
}
.button:active{
    background-color:yellow;
}
#linkeditbar{
    display:none;
    position:absolute;
    right:0px;
    bottom:0px;
    top:0px;
    left:0px;
    overflow:scroll;
    font-family:courier;
}
#sliderbar{
    position:absolute;
    left:0px;
    right:50%;
    top:50%;
    bottom:0px;
    z-index:1;
    background-color:beige;
}
#sliderbar2{
    position:absolute;
    right:0px;
    left:50%;
    top:50%;
    bottom:0px;
    z-index:1;
    background-color:antiquewhite;
}

</style>
</body>
</html>